/*! For license information please see index.cjs.LICENSE.txt */
(()=>{"use strict";const t=require("express"),n=require("fs"),r=require("path");function e(){var t,n,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",c=r.toStringTag||"@@toStringTag";function a(r,e,i,c){var a=e&&e.prototype instanceof f?e:f,l=Object.create(a.prototype);return o(l,"_invoke",function(r,e,o){var i,c,a,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,c=0,a=t,p.n=r,u}};function v(r,e){for(c=r,a=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(a=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(c=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,c=0))}if(o||r>1)return u;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),c=l,a=y;(n=c<2?t:a)||!s;){i||(c?c<3?(c>1&&(p.n=-1),v(c,a)):p.n=a:p.v=a);try{if(f=2,i){if(c||(o="next"),n=i[o]){if(!(n=n.call(i,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,c<2&&(c=0)}else 1===c&&(n=i.return)&&n.call(i),c<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((n=(s=p.n<0)?a:r.call(e,p))!==u)break}catch(n){i=t,c=1,a=n}finally{f=1}}return{value:n,done:s}}}(r,i,c),!0),l}var u={};function f(){}function l(){}function s(){}n=Object.getPrototypeOf;var p=[][i]?n(n([][i]())):(o(n={},i,function(){return this}),n),v=s.prototype=f.prototype=Object.create(p);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,o(t,c,"GeneratorFunction")),t.prototype=Object.create(v),t}return l.prototype=s,o(v,"constructor",s),o(s,"constructor",l),l.displayName="GeneratorFunction",o(s,c,"GeneratorFunction"),o(v),o(v,c,"Generator"),o(v,i,function(){return this}),o(v,"toString",function(){return"[object Generator]"}),(e=function(){return{w:a,m:y}})()}function o(t,n,r,e){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}o=function(t,n,r,e){function c(n,r){o(t,n,function(t){return this._invoke(n,r,t)})}n?i?i(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(c("next",0),c("throw",1),c("return",2))},o(t,n,r,e)}function i(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function c(t){return function(){var n=this,r=arguments;return new Promise(function(e,o){var c=t.apply(n,r);function a(t){i(c,e,o,a,u,"next",t)}function u(t){i(c,e,o,a,u,"throw",t)}a(void 0)})}}function a(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=f(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var e=0,o=function(){};return{s:o,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,a=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){a=!0,i=t},f:function(){try{c||null==r.return||r.return()}finally{if(a)throw i}}}}function u(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,i,c,a=[],u=!0,f=!1;try{if(i=(r=r.call(t)).next,0===n){if(Object(r)!==r)return;u=!1}else for(;!(u=(e=i.call(r)).done)&&(a.push(e.value),a.length!==n);u=!0);}catch(t){f=!0,o=t}finally{try{if(!u&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(f)throw o}}return a}}(t,n)||f(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,n){if(t){if("string"==typeof t)return l(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,n):void 0}}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=Array(n);r<n;r++)e[r]=t[r];return e}var s=new Map,p=r.join(process.cwd(),"data","dedup.json"),v=r.dirname(p);function y(){try{var t,r={},e=a(s.entries());try{for(e.s();!(t=e.n()).done;){var o=u(t.value,2),i=o[0],c=o[1];r[i]=c.toISOString()}}catch(t){e.e(t)}finally{e.f()}n.writeFileSync(p,JSON.stringify(r,null,2))}catch(t){console.error("Failed to save dedup data to file:",t)}}function d(){var t,n=new Date,r=!1,e=a(s.entries());try{for(e.s();!(t=e.n()).done;){var o=u(t.value,2),i=o[0],c=o[1];i.startsWith("event:")&&n-c>36e5&&(s.delete(i),r=!0)}}catch(t){e.e(t)}finally{e.f()}var f,l=a(s.entries());try{for(l.s();!(f=l.n()).done;){var p=u(f.value,2),v=p[0],d=p[1];v.startsWith("card:")&&n-d>864e5&&(s.delete(v),r=!0)}}catch(t){l.e(t)}finally{l.f()}r&&y()}function h(t){return b.apply(this,arguments)}function b(){return(b=c(e().m(function t(n){var r,o,i;return e().w(function(t){for(;;)switch(t.n){case 0:if(r="event:".concat(n),o=new Date,!s.has(r)){t.n=1;break}if(i=s.get(r),!(o-i<36e5)){t.n=1;break}return t.a(2,!0);case 1:return s.set(r,o),y(),t.a(2,!1)}},t)}))).apply(this,arguments)}function m(t){return g.apply(this,arguments)}function g(){return(g=c(e().m(function t(n){var r,o,i;return e().w(function(t){for(;;)switch(t.n){case 0:if(r="card:".concat(n),o=new Date,!s.has(r)){t.n=1;break}if(i=s.get(r),!(o-i<864e5)){t.n=1;break}return t.a(2,!0);case 1:return s.set(r,o),y(),t.a(2,!1)}},t)}))).apply(this,arguments)}n.existsSync(v)||n.mkdirSync(v,{recursive:!0}),function(){try{if(n.existsSync(p))for(var t=n.readFileSync(p,"utf8"),r=JSON.parse(t),e=0,o=Object.entries(r);e<o.length;e++){var i=u(o[e],2),c=i[0],a=i[1];s.set(c,new Date(a))}}catch(t){console.error("Failed to load dedup data from file:",t)}}(),d(),setInterval(d,36e5);const w=require("@larksuiteoapi/node-sdk");require("dotenv").config();var O=process.env.APP_ID,j=process.env.APP_SECRET,_=process.env.PORT||3e3,S=(process.env.REDIS_HOST,process.env.REDIS_PORT,new w.Client({appId:O,appSecret:j,domain:w.Domain.Lark}));function T(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return P(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(P(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,P(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,P(s,"constructor",f),P(f,"constructor",u),u.displayName="GeneratorFunction",P(f,o,"GeneratorFunction"),P(s),P(s,o,"Generator"),P(s,e,function(){return this}),P(s,"toString",function(){return"[object Generator]"}),(T=function(){return{w:i,m:p}})()}function P(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}P=function(t,n,r,e){function i(n,r){P(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},P(t,n,r,e)}function G(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function k(t){return function(){var n=this,r=arguments;return new Promise(function(e,o){var i=t.apply(n,r);function c(t){G(i,e,o,c,a,"next",t)}function a(t){G(i,e,o,c,a,"throw",t)}c(void 0)})}}function x(t){return E.apply(this,arguments)}function E(){return(E=k(T().m(function t(n){return T().w(function(t){for(;;)switch(t.n){case 0:if("url_verification"!==n.type){t.n=1;break}return t.a(2,{challenge:n.challenge});case 1:return setImmediate(function(){return F(n)}),t.a(2,{code:0})}},t)}))).apply(this,arguments)}function F(t){return D.apply(this,arguments)}function D(){return(D=k(T().m(function t(n){var r,e,o;return T().w(function(t){for(;;)switch(t.n){case 0:if(r=n.event_id,e=n.retry_cnt,o=e>0){t.n=2;break}return t.n=1,h(r);case 1:o=t.v;case 2:if(!o){t.n=3;break}return t.a(2);case 3:return t.a(2)}},t)}))).apply(this,arguments)}function I(t,n){return A.apply(this,arguments)}function A(){return(A=k(T().m(function t(n,r){return T().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,S.im.message.create({params:{receive_id_type:"chat_id"},data:{receive_id:n,msg_type:"text",content:JSON.stringify({text:r})}});case 1:return t.a(2)}},t)}))).apply(this,arguments)}const M=require("dayjs");var C=new Map,N=new Map,R=new Map;function Y(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";R.set(n,r);var e=new Map;t.forEach(function(t){console.log("ID: ".concat(t.id,", Name: ").concat(t.name)),e.set(t.id,t)}),C.set(n,e),console.log("初始化消息ID:",n),console.log(C)}function q(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(console.log("\n缓存消息ID:",n),console.log(C),void 0===C||null==C)return"";var r=C.get(n);if(void 0===r||null==r)return"";if(r.get(t)){var e,o=r.get(t);return(e=N.get(n)?N.get(n):new Map).set(t,o),N.set(n,e),o.name}return console.log("没有查找到用户信息"),""}function U(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";console.log("完成消息ID:",t);var n=R.get(t);if(void 0===n||null==n)return console.log("没有初始化信息"),"";if(console.log("完成人:",n),void 0===C||null==C||0===C.size)return console.log("没有初始化信息"),"";var r=C.get(t);if(void 0===r||null==r)return console.log("没有初始化信息"),"";if(void 0===N||null==N||0===N.size)return console.log("没有完成信息"),"";var e=N.get(t);if(void 0===e||null==e)return console.log("没有完成信息"),"";var o=r.size-e.size;return r.size>0&&0===o?(console.log("所有人已完成"),R.delete(t),C.delete(t),N.delete(t),n):(console.log("未完成人数:",o),"")}function z(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return H(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(H(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,H(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,H(s,"constructor",f),H(f,"constructor",u),u.displayName="GeneratorFunction",H(f,o,"GeneratorFunction"),H(s),H(s,o,"Generator"),H(s,e,function(){return this}),H(s,"toString",function(){return"[object Generator]"}),(z=function(){return{w:i,m:p}})()}function H(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}H=function(t,n,r,e){function i(n,r){H(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},H(t,n,r,e)}function B(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function J(t){return function(){var n=this,r=arguments;return new Promise(function(e,o){var i=t.apply(n,r);function c(t){B(i,e,o,c,a,"next",t)}function a(t){B(i,e,o,c,a,"throw",t)}c(void 0)})}}function L(t){return W.apply(this,arguments)}function W(){return(W=J(z().m(function t(n){return z().w(function(t){for(;;)switch(t.n){case 0:if("url_verification"!==n.type){t.n=1;break}return t.a(2,{challenge:n.challenge});case 1:return setImmediate(function(){return K(n)}),t.a(2,{code:0})}},t)}))).apply(this,arguments)}function K(t){return V.apply(this,arguments)}function V(){return(V=J(z().m(function t(n){var r,e,o,i,c,a,u,f,l,s,p,v,y,d,h;return z().w(function(t){for(;;)switch(t.n){case 0:return r=n.event,e=r.operator.open_id,o=r.context,i=o.open_chat_id,c=o.open_message_id,a=r.action.value,u=a.titleTxt,f=a.redirectUrlTxt,l=i+c+e,t.n=1,m(l);case 1:if(!t.v){t.n=2;break}return t.a(2);case 2:if(""!==(s=q(String(e),c))){t.n=3;break}return t.a(2,{code:0});case 3:return p=M().format("YYYY-MM-DD HH:mm"),v={receive_id:i,template_id:"ctp_AAIV1SKqwXnP",template_variable:{users:s,timeStr:p,titleTxt:u,redirectUrl:f,redirectUrlTxt:f}},t.n=4,X(v);case 4:if(y=U(c),console.log("doneTaskOpenId.",y),""===y.trim()){t.n=5;break}return d={timeStr:p,titleTxt:u,mentionUser:'<at id="'.concat(y,'"></at>')},h={receive_id:i,template_id:"ctp_AAI1pp9Okj2I",template_variable:d},t.n=5,X(h);case 5:return t.a(2)}},t)}))).apply(this,arguments)}function X(t){return $.apply(this,arguments)}function $(){return $=J(z().m(function t(n){var r,e,o,i=arguments;return z().w(function(t){for(;;)switch(t.n){case 0:return r=i.length>1&&void 0!==i[1]&&i[1],console.log("发送卡片消息:",n),console.log(n),r&&(e=n.doneUser,delete n.doneUser),t.n=1,S.im.message.createByCard({params:{receive_id_type:"chat_id"},data:n});case 1:return 0===(o=t.v).code&&(console.log("✅ 卡片消息发送成功:",o.data),r&&o.data.mentions?(console.log("缓存卡片消息"),Y(o.data.mentions,o.data.message_id,e)):console.log("没有缓存卡片消息")),t.a(2,{code:0})}},t)})),$.apply(this,arguments)}function Q(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return Z(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(Z(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,Z(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,Z(s,"constructor",f),Z(f,"constructor",u),u.displayName="GeneratorFunction",Z(f,o,"GeneratorFunction"),Z(s),Z(s,o,"Generator"),Z(s,e,function(){return this}),Z(s,"toString",function(){return"[object Generator]"}),(Q=function(){return{w:i,m:p}})()}function Z(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Z=function(t,n,r,e){function i(n,r){Z(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},Z(t,n,r,e)}function tt(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function nt(){var t;return t=Q().m(function t(n){return Q().w(function(t){for(;;)switch(t.n){case 0:return console.log("接收到文档更新的script:",n),t.n=1,X(n,!0);case 1:return t.a(2,t.v)}},t)}),nt=function(){var n=this,r=arguments;return new Promise(function(e,o){var i=t.apply(n,r);function c(t){tt(i,e,o,c,a,"next",t)}function a(t){tt(i,e,o,c,a,"throw",t)}c(void 0)})},nt.apply(this,arguments)}function rt(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return et(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(et(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,et(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,et(s,"constructor",f),et(f,"constructor",u),u.displayName="GeneratorFunction",et(f,o,"GeneratorFunction"),et(s),et(s,o,"Generator"),et(s,e,function(){return this}),et(s,"toString",function(){return"[object Generator]"}),(rt=function(){return{w:i,m:p}})()}function et(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}et=function(t,n,r,e){function i(n,r){et(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},et(t,n,r,e)}function ot(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function it(){var t;return t=rt().m(function t(n){var r,e;return rt().w(function(t){for(;;)switch(t.n){case 0:return console.log("接收到excel文档更新事件:",n),r=n.receive_id,e=n.content,t.n=1,I(r,e);case 1:return t.a(2,t.v)}},t)}),it=function(){var n=this,r=arguments;return new Promise(function(e,o){var i=t.apply(n,r);function c(t){ot(i,e,o,c,a,"next",t)}function a(t){ot(i,e,o,c,a,"throw",t)}c(void 0)})},it.apply(this,arguments)}function ct(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return at(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(at(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,at(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,at(s,"constructor",f),at(f,"constructor",u),u.displayName="GeneratorFunction",at(f,o,"GeneratorFunction"),at(s),at(s,o,"Generator"),at(s,e,function(){return this}),at(s,"toString",function(){return"[object Generator]"}),(ct=function(){return{w:i,m:p}})()}function at(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}at=function(t,n,r,e){function i(n,r){at(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},at(t,n,r,e)}function ut(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}var ft={word_update:function(t){return nt.apply(this,arguments)},excel_update:function(t){return it.apply(this,arguments)}};const lt=function(t,n){return(r=ct().m(function r(){var e;return ct().w(function(r){for(;;)switch(r.n){case 0:if(e=ft[t]){r.n=1;break}throw new Error("未知指令：".concat(t));case 1:return r.n=2,e(n);case 2:return r.a(2,r.v)}},r)}),function(){var t=this,n=arguments;return new Promise(function(e,o){var i=r.apply(t,n);function c(t){ut(i,e,o,c,a,"next",t)}function a(t){ut(i,e,o,c,a,"throw",t)}c(void 0)})})();var r};function st(t){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(t)}function pt(t){var n="function"==typeof Map?new Map:void 0;return pt=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(n){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,r)}function r(){return function(t,n,r){if(vt())return Reflect.construct.apply(null,arguments);var e=[null];e.push.apply(e,n);var o=new(t.bind.apply(t,e));return r&&yt(o,r.prototype),o}(t,arguments,dt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),yt(r,t)},pt(t)}function vt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(vt=function(){return!!t})()}function yt(t,n){return yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},yt(t,n)}function dt(t){return dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},dt(t)}var ht=function(t){function n(t,r){var e;return function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),(e=function(t,n,r){return n=dt(n),function(t,n){if(n&&("object"==st(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,vt()?Reflect.construct(n,r||[],dt(t).constructor):n.apply(t,r))}(this,n,[t])).statusCode=r,e.isOperational=!0,Error.captureStackTrace(e,e.constructor),e}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&yt(t,n)}(n,t),r=n,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(pt(Error));function bt(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return mt(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(mt(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,mt(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,mt(s,"constructor",f),mt(f,"constructor",u),u.displayName="GeneratorFunction",mt(f,o,"GeneratorFunction"),mt(s),mt(s,o,"Generator"),mt(s,e,function(){return this}),mt(s,"toString",function(){return"[object Generator]"}),(bt=function(){return{w:i,m:p}})()}function mt(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}mt=function(t,n,r,e){function i(n,r){mt(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},mt(t,n,r,e)}function gt(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function wt(){var t;return t=bt().m(function t(n,r,e){var o,i,c,a;return bt().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,o=n.body.command){t.n=1;break}throw new ht("没有提供命令",400);case 1:return delete(i=n.body).command,t.n=2,lt(o,i);case 2:c=t.v,r.json(c),t.n=4;break;case 3:t.p=3,a=t.v,e(a);case 4:return t.a(2)}},t,null,[[0,3]])}),wt=function(){var n=this,r=arguments;return new Promise(function(e,o){var i=t.apply(n,r);function c(t){gt(i,e,o,c,a,"next",t)}function a(t){gt(i,e,o,c,a,"throw",t)}c(void 0)})},wt.apply(this,arguments)}var Ot=t.Router();Ot.post("/",function(t,n,r){return wt.apply(this,arguments)});const jt=Ot;function _t(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return St(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(St(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,St(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,St(s,"constructor",f),St(f,"constructor",u),u.displayName="GeneratorFunction",St(f,o,"GeneratorFunction"),St(s),St(s,o,"Generator"),St(s,e,function(){return this}),St(s,"toString",function(){return"[object Generator]"}),(_t=function(){return{w:i,m:p}})()}function St(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}St=function(t,n,r,e){function i(n,r){St(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},St(t,n,r,e)}function Tt(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function Pt(){var t;return t=_t().m(function t(n){return _t().w(function(t){for(;;)switch(t.n){case 0:return console.log("处理lark事件消息",n),t.n=1,x(n);case 1:return t.a(2,t.v)}},t)}),Pt=function(){var n=this,r=arguments;return new Promise(function(e,o){var i=t.apply(n,r);function c(t){Tt(i,e,o,c,a,"next",t)}function a(t){Tt(i,e,o,c,a,"throw",t)}c(void 0)})},Pt.apply(this,arguments)}function Gt(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return kt(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(kt(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,kt(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,kt(s,"constructor",f),kt(f,"constructor",u),u.displayName="GeneratorFunction",kt(f,o,"GeneratorFunction"),kt(s),kt(s,o,"Generator"),kt(s,e,function(){return this}),kt(s,"toString",function(){return"[object Generator]"}),(Gt=function(){return{w:i,m:p}})()}function kt(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}kt=function(t,n,r,e){function i(n,r){kt(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},kt(t,n,r,e)}function xt(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function Et(){var t;return t=Gt().m(function t(n){return Gt().w(function(t){for(;;)switch(t.n){case 0:return console.log("处理lark按钮点击消息:"),t.n=1,L(n);case 1:return t.a(2,t.v)}},t)}),Et=function(){var n=this,r=arguments;return new Promise(function(e,o){var i=t.apply(n,r);function c(t){xt(i,e,o,c,a,"next",t)}function a(t){xt(i,e,o,c,a,"throw",t)}c(void 0)})},Et.apply(this,arguments)}const Ft={handleEvent:function(t){return Pt.apply(this,arguments)},handleCard:function(t){return Et.apply(this,arguments)}};function Dt(){var t,n,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,e,o,i){var u=e&&e.prototype instanceof a?e:a,f=Object.create(u.prototype);return It(f,"_invoke",function(r,e,o){var i,a,u,f=0,l=o||[],s=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,r){return i=n,a=0,u=t,p.n=r,c}};function v(r,e){for(a=r,u=e,n=0;!s&&f&&!o&&n<l.length;n++){var o,i=l[n],v=p.p,y=i[2];r>3?(o=y===e)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=r<2&&v<i[1])?(a=0,p.v=e,p.n=i[1]):v<y&&(o=r<3||i[0]>e||e>y)&&(i[4]=r,i[5]=e,p.n=y,a=0))}if(o||r>1)return c;throw s=!0,e}return function(o,l,y){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,y),a=l,u=y;(n=a<2?t:u)||!s;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(s=p.n<0)?u:r.call(e,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:s}}}(r,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(It(n={},e,function(){return this}),n),s=f.prototype=a.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,It(t,o,"GeneratorFunction")),t.prototype=Object.create(s),t}return u.prototype=f,It(s,"constructor",f),It(f,"constructor",u),u.displayName="GeneratorFunction",It(f,o,"GeneratorFunction"),It(s),It(s,o,"Generator"),It(s,e,function(){return this}),It(s,"toString",function(){return"[object Generator]"}),(Dt=function(){return{w:i,m:p}})()}function It(t,n,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}It=function(t,n,r,e){function i(n,r){It(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!e,configurable:!e,writable:!e}):t[n]=r:(i("next",0),i("throw",1),i("return",2))},It(t,n,r,e)}function At(t,n,r,e,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void r(t)}a.done?n(u):Promise.resolve(u).then(e,o)}function Mt(t){return function(){var n=this,r=arguments;return new Promise(function(e,o){var i=t.apply(n,r);function c(t){At(i,e,o,c,a,"next",t)}function a(t){At(i,e,o,c,a,"throw",t)}c(void 0)})}}function Ct(){return(Ct=Mt(Dt().m(function t(n,r,e){var o,i;return Dt().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Ft.handleEvent(n.body);case 1:o=t.v,r.status(200).json(o),t.n=3;break;case 2:t.p=2,i=t.v,e(i);case 3:return t.a(2)}},t,null,[[0,2]])}))).apply(this,arguments)}function Nt(){return(Nt=Mt(Dt().m(function t(n,r,e){var o,i;return Dt().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Ft.handleCard(n.body);case 1:o=t.v,r.status(200).json(o),t.n=3;break;case 2:t.p=2,i=t.v,e(i);case 3:return t.a(2)}},t,null,[[0,2]])}))).apply(this,arguments)}var Rt=t.Router();Rt.post("/event",function(t,n,r){return Ct.apply(this,arguments)}),Rt.post("/message-card",function(t,n,r){return Nt.apply(this,arguments)});const Yt=Rt,qt=require("winston");require("winston-daily-rotate-file");var Ut=(0,require("url").fileURLToPath)("file:///Users/bob/Desktop/project/lark-application/src/middlewares/logger.js"),zt=r.dirname(Ut),Ht=r.join(zt,"../../logs");n.existsSync(Ht)||n.mkdirSync(Ht,{recursive:!0});var Bt=new qt.transports.DailyRotateFile({filename:r.join(Ht,"application-%DATE%.log"),datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d"}),Jt=qt.createLogger({level:"info",format:qt.format.combine(qt.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),qt.format.printf(function(t){var n=t.timestamp,r=t.level,e=t.message;return"[".concat(n,"] ").concat(r,": ").concat(e)})),transports:[Bt,new qt.transports.Console({format:qt.format.combine(qt.format.colorize(),qt.format.printf(function(t){var n=t.timestamp,r=t.level,e=t.message;return"[".concat(n,"] ").concat(r,": ").concat(e)}))})]}),Lt=t();Lt.use(t.json()),Lt.use(function(t,n,r){var e=Date.now(),o=t.method,i=t.originalUrl,c=t.ip;n.on("finish",function(){var t=Date.now()-e,r=n.statusCode;Jt.info("".concat(o," ").concat(i," ").concat(r," ").concat(t,"ms - ").concat(c))}),r()}),Lt.use("/notify",jt),Lt.use("/webhook",Yt),Lt.use(function(t,n,r,e){t.statusCode=t.statusCode||500,t.message=t.message||"Internal Server Error",console.error("Error:",t),t.isOperational?r.status(t.statusCode).json({code:t.statusCode,msg:t.message}):r.status(500).json({code:500,msg:"服务异常，请稍后再试"})}),Lt.listen(_,function(){console.log("🚀 Server running at http://localhost:".concat(_))})})();