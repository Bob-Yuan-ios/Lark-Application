# 部署上线流程

1. 本地编译是否正常（是否能够正确编译成功，webpack打包）
2. 确定服务器node版本（没有安装node先安装node，再装一个nvm的版本管理工具）
3. 安装npm包
4. 编译程序
5. 先确定有没有安装pm2，没有先安装
6. 确定有没有pm2.config.cjs启动脚本，没有编写一个pm2.config.cjs
7. pm2启动

# 部署脚本使用方法

1. 给脚本添加执行权限：`chmod +x deploy.sh`
2. 运行部署脚本：`./deploy.sh`

# 手动重启应用指令

1. 进入项目目录：`cd /path/to/project`
2. 重启应用：`pm2 restart lark-application`

# 手动关闭应用指令

1. 进入项目目录：`cd /path/to/project`
2. 停止应用：`pm2 stop lark-application`
3. 停止所有应用：`pm2 stop all`

# 回滚操作步骤

1. 停止当前应用：`pm2 stop lark-application`
2. 查找备份版本：`ls -la ./backups/`
3. 删除当前版本：`rm -rf ./build`
4. 恢复备份版本：`cp -r ./backups/备份目录名 ./build`
5. 重新启动应用：`pm2 start pm2.config.cjs`

# 注意事项

- 确保服务器已安装Node.js和npm
- 脚本会自动检查并安装PM2（如果未安装）
- 脚本会自动创建pm2.config.cjs（如果不存在）
- 部署前请确保代码已提交到服务器
- 应用配置了自动重启功能，当应用异常退出时会自动重启
- 应用配置了内存限制重启功能，当内存使用超过1G时会自动重启
- 部署脚本会自动备份当前版本到backups目录（在首次部署时自动创建），系统最多保留5个备份版本，超出的旧备份会自动删除
- 只有在成功部署后才会有备份版本，当前尚未执行过部署所以没有备份
- 回滚时请根据部署时间选择正确的备份版本
- 应用日志通过winston管理，单个文件最大20MB，保留14天的日志
- PM2日志配置在pm2.config.cjs中，单个文件最大20MB
- 部署日志通过logrotate管理，单个文件最大10MB，最多保留10个历史文件